<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — App</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;}
    body{background:linear-gradient(180deg,#f2f5f9 0%,#e9eef6 100%);display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;}
    .card{width:360px;background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(9,30,66,0.08);padding:28px;}
    .brand{color:#1c1e21;font-size:20px;font-weight:600;margin-bottom:6px}
    .subtitle{color:#606770;font-size:13px;margin-bottom:20px}
    .input{width:100%;padding:12px 14px;margin-bottom:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:#fff;font-size:15px;outline:none;transition:box-shadow .12s,border-color .12s}
    .input:focus{border-color:rgba(24,119,242,0.85);box-shadow:0 4px 14px rgba(24,119,242,0.12)}
    .btn{width:100%;padding:12px;border-radius:8px;border:none;font-size:15px;cursor:pointer;margin-top:8px}
    .btn-login{background:#1877F2;color:#fff;font-weight:600;box-shadow:0 4px 10px rgba(24,119,242,0.12)}
    .btn-google{background:#fff;color:#111;border:1px solid rgba(0,0,0,0.08);display:flex;justify-content:center;align-items:center;gap:10px}
    .google-icon{width:18px;height:18px}
    .actions{margin-top:10px}
    .msg{font-size:13px;margin-top:8px;text-align:center}
    .error{color:#b00020}
    .success{color:#0b6623}
  </style>
</head>
<body>
  <div class="card" role="main" aria-label="Login Card">
    <div class="brand">Login</div>
    <div class="subtitle">Inicie sessão com Whayame-Line</div>

    <input id="email" class="input" type="email" placeholder="Seu endereço de email" autocomplete="email" />
    <input id="password" class="input" type="password" placeholder="Sua senha" autocomplete="current-password" />

    <div class="actions">
      <button id="btnLogin" class="btn btn-login">Login</button>

      <button id="btnGoogle" class="btn btn-google" style="margin-top:10px;">
        <img class="google-icon" alt="" src="https://www.svgrepo.com/show/475656/google-color.svg" />
        Continuar com Google
      </button>

      <div id="msg" class="msg error" style="display:none"></div>
      <div id="msgSuccess" class="msg success" style="display:none"></div>
    </div>

    <div class="footer-note" style="margin-top:14px;font-size:12px;color:#8d939b;text-align:center">Whayame-Line</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ---------- CONFIGURAÇÃO FIREBASE (já preenchida com suas chaves) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyCVIhK2lTuH0cT77A72h61D3XU0dIATcOA",
      authDomain: "zeca-58cd9.firebaseapp.com",
      projectId: "zeca-58cd9",
      storageBucket: "zeca-58cd9.appspot.com",
      messagingSenderId: "174758634885",
      appId: "1:174758634885:web:40128123afb274856c10ec"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Elementos
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('password');
    const btnLogin = document.getElementById('btnLogin');
    const btnGoogle = document.getElementById('btnGoogle');
    const msg = document.getElementById('msg');
    const msgSuccess = document.getElementById('msgSuccess');

    function showError(text){
      msg.style.display = 'block';
      msg.className = 'msg error';
      msg.textContent = text;
      msgSuccess.style.display = 'none';
    }
    function showSuccess(text){
      msgSuccess.style.display = 'block';
      msgSuccess.className = 'msg success';
      msgSuccess.textContent = text;
      msg.style.display = 'none';
    }
    function clearMessages(){
      msg.style.display = 'none';
      msgSuccess.style.display = 'none';
    }

    // validação simples do formato do e-mail
    function emailValido(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // --------- Login com email e senha (com testes e redirecionamento) ----------
    btnLogin.addEventListener('click', async () => {
      clearMessages();
      const email = emailInput.value.trim();
      const password = passInput.value;

      if (!email || !password) {
        showError('Preencha email e senha.');
        return;
      }
      if (!emailValido(email)) {
        showError('Formato de e-mail inválido.');
        return;
      }

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        // Se chegar aqui, email e senha estão corretos
        showSuccess('Login efetuado com sucesso! A redirecionar...');
        // --- REDIRECIONE para a página que quiser após login via email:
        // Mude 'email-dashboard.html' para o ficheiro que tu quiser
        window.location.href = 'Projeto.html';
      } catch (err) {
        console.error(err);
        // mensagens amigáveis com base em err.code
        const code = err.code || '';
        if (code.includes('invalid-email')) showError('E-mail inválido.');
        else if (code.includes('user-not-found')) showError('Usuário não encontrado.');
        else if (code.includes('wrong-password')) showError('Senha incorreta.');
        else showError('Erro ao efetuar login: ' + (err.message || 'tente novamente'));
      }
    });

    // --------- Login com Google (com redirecionamento específico) ----------
    btnGoogle.addEventListener('click', async () => {
      clearMessages();
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        showSuccess('Login com Google efetuado! A redirecionar...');
        // --- REDIRECIONE para a página que quiser após login via Google:
        // Mude 'google-dashboard.html' para o ficheiro que tu quiser
        window.location.href = 'Projeto.html';
      } catch (err) {
        console.error(err);
        showError('Erro no login com Google: ' + (err.message || 'tente novamente'));
      }
    });

    // --------- Verifica sessão existente ao abrir (mantém usuário logado) ----------
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // O usuário já está logado — decide para onde enviar
        // Detecta providers para diferenciar (ex.: google)
        const providers = (user.providerData || []).map(p => p.providerId);
        if (providers.includes('google.com')) {
          // usuário logado via Google — envia para a página Google
          window.location.href = '/storage/emulated/0/tarefa /index.html';
        } else {
          // usuário logado via e-mail/senha — envia para a página Email
          window.location.href = '/storage/emulated/0/tarefa /index.html';
        }
      } else {
        // ninguém logado — permanece na tela de login (padrão)
        console.log('Nenhum usuário logado.');
      }
    });

    /* -------------------------
       DICA PARA CRIAR CONTAS DE TESTE (opcional)
       Você não tem botão de cadastro na UI — portanto:
       1) Crie usuários manualmente no Firebase Console → Authentication → Users → Add user
       OU
       2) Temporariamente adicione e chame createUserWithEmailAndPassword() para criar um usuário.
       NÃO deixe a função de criação habilitada em produção se não quiser cadastro público.
       ------------------------- */
  </script>
</body>
</html>
